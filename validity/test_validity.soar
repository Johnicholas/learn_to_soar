setup {

source validity.soar

sp {initialize
  (state <s> ^superstate nil)
-->
  (<s> ^name validity-test)}

}

test "var(x) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.var x ^env empty ^todo done ^desired false)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env>)
  (<env> ^key x ^value false ^env empty)
-->
  (pass)}

}

test "and(var(x), var(x)) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.and <and> ^env empty ^todo done ^desired false)
  (<and> ^p.var x ^q.var x)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env>)
  (<env> ^key x ^value false ^env empty)
-->
  (pass)}

}

test "and(var(x), var(y)) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.and <and> ^env empty ^todo done ^desired false)
  (<and> ^p.var x ^q.var y)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env>)
  (<env> ^key x ^value false ^env empty)
-->
  (pass)}

}

test "or(var(x), var(x)) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.or <or> ^env empty ^todo done ^desired false)
  (<or> ^p.var x ^q.var x)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env>)
  (<env> ^key x ^value false ^env empty)
-->
  (pass)}

}

test "or(var(x), var(y)) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.or <or> ^env empty ^todo done ^desired false)
  (<or> ^p.var x ^q.var y)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env1>)
  (<env1> ^key y ^value false ^env <env2>)
  (<env2> ^key x ^value false ^env empty)
-->
  (pass)}

}

test "or(not(var(x)), var(y)) should be invalid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.or <or> ^env empty ^todo done ^desired false)
  (<or> ^p.not.var x ^q.var y)}

sp {pass
  (state <s> ^name validity-test ^validity-done <env1>)
  (<env1> ^key y ^value false ^env <env2>)
  (<env2> ^key x ^value true ^env empty)
-->
  (pass)}

}

test "or(not(var(x)), var(x)) should be valid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.or <or> ^env empty ^todo done ^desired false)
  (<or> ^p.not.var x ^q.var x)}

sp {pass
  (state <s> ^name validity-test ^validity-done empty)
-->
  (pass)}

}

test "a complicated expression that should be valid" {

sp {propose*validity
  (state <s> ^name validity-test)
-->
  (<s> ^operator <o> +)
  (<o> ^name validity ^exp.or <or1> ^env empty ^todo done ^desired false)
  (<or1> ^p.not.or <or2> ^q.or <or3>)
  (<or2> ^p.var p ^q.var q)
  (<or3> ^p.not.and <and4> ^q.var r)
  (<and4> ^p.or <or6> ^q.or <or7>)
  (<or6> ^p.not.var p ^q.var r)
  (<or7> ^p.not.var q ^q.var r)}

sp {pass
  (state <s> ^name validity-test ^validity-done empty)
-->
  (pass)}

}

#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("r")))) == true);
#  assert(test(OR(NOT(OR(VAR("x"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("r"
#			))))
#	 == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("x"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("r")))) == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("x")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("r")))) == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("x")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("r")))) == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("x")),
#			       VAR("r")))),
#		    VAR("r")))) == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("x")))),
#		    VAR("r")))) == false);
#  assert(test(OR(NOT(OR(VAR("p"), VAR("q"))),
#		 OR(NOT(AND(OR(NOT(VAR("p")),
#			       VAR("r")),
#			    OR(NOT(VAR("q")),
#			       VAR("r")))),
#		    VAR("x")))) == false);

